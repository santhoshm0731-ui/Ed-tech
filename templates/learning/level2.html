{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="container py-4">
  <h3>{{ level.title }}</h3>
  <p>{{ level.description }}</p>

  <div class="row">
    <div class="col-md-6">
      <div class="ratio ratio-16x9 mb-3">
        {% if level.video_url %}
          <iframe src="{{ level.video_url }}" title="Level 2 Video" allowfullscreen></iframe>
        {% else %}
          <div class="d-flex align-items-center justify-content-center" style="height:300px;background:#f5f5f5;">
            <p class="text-muted">Video placeholder. Upload video in admin or set Level.video_url</p>
          </div>
        {% endif %}
      </div>

      <h5>Classification Game</h5>
      <p>Drag the items into the correct dustbin on the right. Earn points for correct classifications.</p>

      <div id="items" class="d-flex flex-wrap" style="gap:10px;"></div>
    </div>

    <div class="col-md-6">
      <h5>Dustbins</h5>
      <div id="bins" class="d-flex flex-column" style="gap:15px;">
        <div class="bin" data-bin="wet" style="padding:20px;border:2px dashed #6c757d;min-height:80px" data-bin-label="Wet Waste">Wet Waste</div>
        <div class="bin" data-bin="dry" style="padding:20px;border:2px dashed #6c757d;min-height:80px" data-bin-label="Dry Waste">Dry Waste</div>
        <div class="bin" data-bin="recycle" style="padding:20px;border:2px dashed #6c757d;min-height:80px" data-bin-label="Recyclables">Recyclables</div>
      </div>

      <div class="mt-3">
        <button id="submitGame" class="btn btn-success">Submit Game</button>
        <p class="mt-2">Score: <span id="gameScore">0</span></p>
      </div>

      {% if quiz %}
        <hr>
        <h5>Quiz</h5>
        <form id="quizForm">
          {% csrf_token %}
          {% for q in quiz.questions.all %}
            <div class="mb-3">
              <p><strong>{{ forloop.counter }}. {{ q.text }}</strong></p>
              {% for c in q.choices.all %}
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="q_{{ q.id }}" id="c_{{ c.id }}" value="{{ c.id }}">
                  <label class="form-check-label" for="c_{{ c.id }}">{{ c.text }}</label>
                </div>
              {% endfor %}
              <div class="mt-2 text-muted" id="explain_{{ q.id }}" style="display:none"></div>
            </div>
          {% endfor %}
          <button type="button" id="submitQuiz" class="btn btn-primary">Submit Quiz</button>
        </form>
      {% endif %}
    </div>
  </div>
</div>

<script>
  // We rely on static/js/level2_game.js; minimal inline initialization for template variables
  const ITEMS_FOR_GAME = [
    {id: 'i1', label: 'Apple core', bin: 'wet'},
    {id: 'i2', label: 'Plastic bottle', bin: 'recycle'},
    {id: 'i3', label: 'Paper', bin: 'dry'},
    {id: 'i4', label: 'Tea leaves', bin: 'wet'},
    {id: 'i5', label: 'Glass jar', bin: 'recycle'}
  ];

  // Provide URLs for AJAX
  window.ECO_CONFIG = {
    awardPointsUrl: "{% url 'award_points' %}"
  };
</script>
{% endblock %}
